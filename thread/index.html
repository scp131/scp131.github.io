<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
        <meta name="theme-color" content="#3F51B5">
        <meta name="keywords" content="Scp131, 后端开发, 个人博客,java,spring,算法,idea,docker, material design">
        <meta name="description" content="">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Scp131 Blog">
        <meta property="og:url" content="https://scp131.github.io">
        <meta property="og:site_name" content="Scp131 Blog">
        <meta property="og:description" content="">
        <title>java锁初探 | Scp 131</title>
        <link rel="shortcut icon" href="/favicon.ico">
        <link rel="canonical" href="https://scp131.github.io">

<link rel="styleSheet"  href="/css/style.min.css"/></head>
    <body><div id="loading" class="active"></div>
<aside id="menu"  class="hide"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.webp)">
      <div class="brand">
        <a href="" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.webp">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Kmiss</h5>
          <a href="mailto:1355337315@qq.com" title="1355337315@qq.com" class="mail">1355337315@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
 
            <li class="waves-block waves-effect ">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
            
            <li class="waves-block waves-effect ">
              <a href="/categories/">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect ">
              <a href="/tags/">
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
            
            <li class="waves-block waves-effect ">
              <a href="/links/">
                <i class="icon icon-lg icon-link"></i>
                Links
              </a>
            </li>
            
            
            <li class="waves-block waves-effect">
              <a href="https://github.com/scp131" target="_blank">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
      </ul>
    </div>
  </div>
</aside>
<main id="main">
          <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">java锁初探</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="请输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    
    <div class="container fade-scale">
        <h1 class="title">java锁初探</h1>
        <h5 class="subtitle">
            
            
            
              <time datetime="2019-12-11 00:00:00 &#43;0000 UTC" itemprop="datePublished" class="page-time">
                2019年12月11日
              </time>
            
        </h5>
    </div>
    
    
</header>
<div class="container body-wrap"><div class="domHide">
   <nav id="TableOfContents">
  <ul>
    <li><a href="#同步代码块">同步代码块</a></li>
    <li><a href="#方法锁">方法锁</a></li>
    <li><a href="#类锁">类锁</a></li>
    <li><a href="#volatitle">Volatitle</a></li>
    <li><a href="#countdownlatch">CountDownLatch</a></li>
    <li><a href="#reentrantlock">ReentrantLock</a></li>
    <li><a href="#锁的底层原理">锁的底层原理</a></li>
    <li><a href="#锁的种类">锁的种类</a></li>
  </ul>
</nav>
</div>

<aside class="post-widget">
    <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
        <h4>TOC</h4>
    </nav>
</aside>
  <article id="post-multipart-x-mixed-replace" class="post-article article-type-post fade" itemprop="blogPost">
    <div class="post-card">
    
      <h1 class="post-card-title">java锁初探</h1><div class="post-meta">
             
     
     <time class="post-time" title="2019-12-11 00:00:00 &#43;0000 UTC" datetime="2019-12-11 00:00:00 &#43;0000 UTC"  itemprop="datePublished">
        2019年12月11日
     </time>
     
     
     <ul class="article-category-list">
     <li class="article-category-list-item">
            <a class="article-category-list-link" href="https://scp131.github.io/categories/java%E5%9F%BA%E7%A1%80/">Java基础</a>
          </li>
        
        
     </ul>
         
     
     <span id="busuanzi_container_page_pv" title="文章总阅读量" >
        <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv">233</span>
    </span>
</div><div class="post-content" id="post-content" itemprop="postContent">
          <h2 id="同步代码块">同步代码块</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
     
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="c1">//其余耗时操作
</span><span class="c1"></span>        <span class="kd">synchronized</span><span class="o">(</span><span class="n">o</span><span class="o">){</span>
            <span class="c1">//临界资源(多个线程都能访问的资源)
</span><span class="c1"></span>            <span class="n">count</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></div><p>当代码中有其余的耗时操作 而我们需要同步的代码又只占一小部分的时候 可以使用同步代码块</p>
<p>对于常见类型 可以使用其原子性对象 原子对象的方法都是原子操作，可以保证线程安全如</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">AtomicInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
<span class="n">count</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
</code></pre></div><h2 id="方法锁">方法锁</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">){</span>
        <span class="c1">//锁当前对象
</span><span class="c1"></span>        <span class="c1">//多个线程访问 [ 同一个对象 ] 时生效
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">test3</span><span class="o">(){</span>
    <span class="c1">//锁当前对象  等同于上面
</span><span class="c1"></span><span class="o">}</span>
</code></pre></div><p>证明锁同一个对象</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">methodA</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">methodB</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div><p>针对上面的代码</p>
<p>创建两个线程分别去调用<mark>同一个对象</mark>的methodA和methodB 会触发线程同步</p>
<p>以下情况不会触发线程同步</p>
<ol>
<li>不同对象的同一方法</li>
<li>不同对象的不同方法</li>
<li>同一对象的同步和不同步方法</li>
</ol>
<p>以下讨论方法锁的几种常见情况</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">setTemp</span><span class="o">(</span><span class="kt">int</span> <span class="n">temp</span><span class="o">){</span>
        <span class="c1">//复杂的逻辑代码........
</span><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTemp</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">temp</span><span class="o">;</span>
    <span class="o">}</span>    
<span class="o">}</span>
</code></pre></div><p>如上面代码 如果两个线程分别去调用同一个对象的setTemp和getTemp方法 会导致脏读 一般建议set 或get方法都设置为同步方法</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="n">test2</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="nf">test2</span><span class="o">(){}</span>
    
<span class="o">}</span>
</code></pre></div><p>如上代码为锁的可重入，即同一个线程访问同一个对象多次调用同步方法时可重入，上面代码执行结果为test1()阻塞等待test2()执行结束才会继续执行</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">ATest</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">BTest</span> <span class="kd">extends</span> <span class="n">ATest</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">test</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码也是可重入的一种应用 如果去调用子类的test()方法 子类会阻塞等待父类执行完毕之后再继续执行</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">ATest</span><span class="o">{</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="n">count</span><span class="o">++;</span>
            <span class="k">if</span><span class="o">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">5</span> <span class="o">==</span> <span class="n">0</span><span class="o">){</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码 如果创建两个线程去调用同一个对象的该方法，第一个线程抛出异常时会释放锁，第二个对象获得对象锁继续执行  在遇到同步业务逻辑的时候 抛出异常后该如何处理是需要考虑的</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="n">o</span><span class="o">){</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            	<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;23333333&#34;</span><span class="o">);</span>    
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码 创建两个线程，第一个线程去执行test()方法 ，第二个线程执行之前先执行 o = new Object()，再去调用test()方法，并不会影响第一个线程 ，同步代码块一旦上锁之后，会有一个临时锁引用指向对象和真实的引用无关，在锁释放之前，修改锁对象引用，不会影响代码块的执行。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&#34;lock&#34;</span><span class="o">;</span>
    <span class="n">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">&#34;lock&#34;</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="n">s1</span><span class="o">){}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="n">s2</span><span class="o">){}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码 创建两个线程分别去调用同一个对象的test1()和test2()方法，第二个线程无法执行，因为test和test2锁的是同一个对象，所以在定义同步代码块的时候，不建议使用常量对象作为锁对象。</p>
<h2 id="类锁">类锁</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">test4</span><span class="o">(){</span>
 <span class="c1">//锁class对象
</span><span class="c1"></span> <span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test5</span><span class="o">(){</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">class</span><span class="o">){</span>
    <span class="c1">//锁class类对象 等同于上面
</span><span class="c1"></span>    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>两个线程去访问<mark>同一</mark>或<mark>不同一对象</mark>的methodA和methodB都会触发线程同步</p>
<h2 id="volatitle">Volatitle</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">while</span><span class="o">(</span><span class="n">flag</span><span class="o">){}</span>
    <span class="o">}</span> 
<span class="o">}</span>
</code></pre></div><p>对于上面的代码 如果一个线程去调用test()方法 ，然后将flag改为false 不能结束第一个线程的运行，这是由于cpu在读取代码的时候，会将临时变量值存储到缓存之中，当cpu中断或某些情况发生时，cpu才会清空缓存，重新读取内存临时变量值到缓存中。解决这种问题可以使用volatitle来修饰flag通知cpu将缓存和内存里面的临时变量的值同步，这也称为内存的可见性。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">volatitle</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">count</span><span class="o">++;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码如果创建多个线程去执行test方法，并通过join连接起来，最终打印count会发现count离预想的值要差很多，因为volatitle只能保证可见性，但并不能保证原子性。</p>
<h2 id="countdownlatch">CountDownLatch</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">CountDownLatch</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="n">5</span><span class="o">);</span><span class="c1">//创建5个门闩
</span><span class="c1"></span>    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">latch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span><span class="c1">//等待门闩解开
</span><span class="c1"></span>        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;strat-----&gt;&#34;</span><span class="o">);</span>
    <span class="o">}</span>
    
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">latch</span><span class="o">.</span><span class="na">getCount</span><span class="o">()</span> <span class="o">!=</span> <span class="n">0</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">());</span><span class="c1">//当前门闩的锁数
</span><span class="c1"></span>                <span class="n">latch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span><span class="c1">//减门闩上的锁
</span><span class="c1"></span>            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>可以和锁混合使用，或者替代锁的功能，在门闩未完全开放之前等待，在门闩开放之后执行，避免锁的效率低下问题。</p>
<h2 id="reentrantlock">ReentrantLock</h2>
<p>建议使用的同步方式，相对效率比synchronized高，量级较轻。</p>
<p>一定要手动释放锁标记，一般都是放到finally里面</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
    	<span class="k">try</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;----------------&gt;&#34;</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>    
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;-------------------&gt;&#34;</span><span class="o">);</span>
        <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div><p>ReentrantLock在lock()加锁之后 到unlock()之间的代码都属于同步代码</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//尝试获得锁
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;---------&gt;&#34;</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="kt">boolean</span> <span class="n">isLock</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="c1">//尝试获得锁 如果获得成功返回true
</span><span class="c1"></span>            <span class="c1">//获取不成功 返回 false
</span><span class="c1"></span>            <span class="c1">//isLock = lock.tryLock();
</span><span class="c1"></span>            
            
            <span class="c1">//阻塞尝试锁 在设置的时常内尝试获取锁标记 
</span><span class="c1"></span>            <span class="c1">//如果超时 则直接返回false 不等待
</span><span class="c1"></span>            <span class="n">isLock</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">tryLock</span><span class="o">(</span><span class="n">5</span><span class="o">,</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">isLock</span><span class="o">){</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;已上锁&#34;</span><span class="o">);</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;未上锁&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">isLock</span><span class="o">){</span>
                <span class="c1">//一定要先判断是否获取到锁标记 然后去开锁
</span><span class="c1"></span>                <span class="c1">//否则会抛出异常
</span><span class="c1"></span>                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>尝试获得锁用来判断某个线程是否获得了锁对象</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//尝试打断锁
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="n">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;---------&gt;&#34;</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lockInterruptibly</span><span class="o">();</span><span class="c1">//可尝试打断  阻塞等待锁 可以被其他线程打断阻塞状态
</span><span class="c1"></span>        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;test2 interruptibly.....&#34;</span><span class="o">);</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">//第一个线程去执行test1()
</span><span class="c1"></span>        <span class="c1">//第二个线程去执行test2()
</span><span class="c1"></span>        <span class="n">t2</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码 一个线程正在执行过程中， 另外一个线程尝试去获取锁进入阻塞状态，这种阻塞状态可以被外界打断，并抛出异常，类似于睡觉被别人突然叫醒。</p>
<p>阻塞状态又分为 普通阻塞、阻塞队列、锁池状态</p>
<p>普通阻塞 sleep() 可以调用thread.interrupt()被打断，并抛出异常</p>
<p>阻塞队列 调用wait()进入阻塞状态，只能被唤醒，无法被打断</p>
<p>锁池队列 无法获取锁对象，并不是所有的所持状态的线程都可以被打断</p>
<p>    使用ReentrantLock的lock()获取锁标记，如需阻塞等待锁标记，则无法被打断</p>
<p>    使用ReentrantLock的lockInterruptibly()获取锁标记，如需阻塞等待锁标记，则可以打断</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//公平锁
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestReentrantLock</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="nd">@Ovrride</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;---------&gt;&#34;</span><span class="o">);</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>如上代码 创建两个线程去执行run()，当第一个线程在执行第一次循环的时候，第二个线程处于阻塞状态，第一个线程执行完第一次循环进入阻塞状态，第二个线程执行第一次循环，会出现两个线程交替执行的情况</p>
<blockquote>
<p>在os中线程竞争锁是不公平的，当三个线程同时阻塞等待一把锁，锁释放的时候，不一定是按照先来后到的顺序去获得锁，也许是等待时间较短的先获得锁，而公平锁则是为解决这种问题出现的，等待时间越长一定会获得锁。其底层使用队列实现。</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">//生产者消费者(ReentrantLock)
</span><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
    <span class="kd">private</span> <span class="n">Condition</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
    <span class="kd">private</span> <span class="n">Condition</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">count</span><span class="o">;</span>
    <span class="o">};</span>
    
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
        <span class="k">try</span><span class="o">{</span>
        	<span class="k">while</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">MAX</span><span class="o">){</span>
			<span class="n">producer</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
        	<span class="o">}</span>    
            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="n">count</span><span class="o">++;</span>
            <span class="n">consumer</span><span class="o">.</span><span class="na">singalAll</span><span class="o">();</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">get</span><span class="o">(){</span>
        <span class="n">E</span> <span class="n">e</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">0</span><span class="o">){</span>
                <span class="n">cusumer</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">removeFist</span><span class="o">();</span>
            <span class="n">count</span><span class="o">--;</span>
            <span class="n">producer</span><span class="o">.</span><span class="na">singalAll</span><span class="o">();</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">e</span><span class="o">;</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div><p>如上代码是生产者消费者简单实现，通过设置Condition条件来控制线程之间协作，通过singalAll去唤醒对应的线程，不同于使用notifyAll()，singalAll()能唤醒线程的更精准。</p>
<h2 id="锁的底层原理">锁的底层原理</h2>
<p><figure class="image-bubble">
  <div class="img-lightbox">
     <div class="overlay"></div>
     <img src="https://s1.ax1x.com/2020/04/15/JPMhDJ.png" title=" ">
  </div>
  <div class="image-caption">  </div>
</figure></p>
<p>对象在堆内存中存储主要分为三部分</p>
<p>对象头        存储对象的hashCode、锁信息、分代年龄、GC标志、类型指针指向对象的类、元数据</p>
<p>实例变量	存放对象的实例变量包括父类的实例变量</p>
<p>填充数据    jvm要求对象的起始位置必须为整数倍，填充数据不是必须存在的，仅仅是为了字节对齐
<br/>
<br/></p>
<p>在对象中加锁，数据存储在对象头信息中，在执行synchronized同步方法或同步代码块的时候，会在对象头部记录锁标记，锁标记指向monitor对象(也称为管程或对象监视器锁)的起始位置，每个对象都存在与之对应的monitor对象存在，monitor可以在对象创建时产生，也可以在线程执行同步代码块的时候创建。一个线程持有了对象的锁，其实是线程与对象的monitor相关联。</p>
<p>在jvm中monitor是由ObjectMonitor实现的</p>
<p>在Monitor中存在_WaitSet  (管理等待队列)    _EntryList ( 管理锁池阻塞线程 )   _Owner ( 记录当前执行的线程 ) 三种标记， 线程的状态如下图所示</p>
<p><figure class="image-bubble">
  <div class="img-lightbox">
     <div class="overlay"></div>
     <img src="https://s1.ax1x.com/2020/04/15/JPM4b9.png" title=" ">
  </div>
  <div class="image-caption">  </div>
</figure></p>
<p>当多个线程访问同一个同步代码的时候，线程先进入锁池_EntryList中，当某个线程获取锁标记的时候，Monitor的 _Owner会记录该线程，并在Monitor的计数器中执行递增运算(+1)，当该线程执行完毕或wait()放弃锁的时候，Monitor计数器置为0，同时 _Owner置为null,等待下一个线程获取锁标记。</p>
<h2 id="锁的种类">锁的种类</h2>
<p>java中的锁大致分为偏向锁、轻量锁、重量锁、自旋锁。</p>
<p>锁的升级方式为 系统先提供偏向锁，偏向锁不能满足需求则提供轻量锁，轻量锁不满足要求则提供重量锁，自旋锁是一种锁的状态，不是一种实际的锁的类型。</p>
<p>锁的升级由jvm操作无需程序员干涉。</p>
<blockquote>
<p>偏向锁 当线程中不可能存在多个线程争夺一个锁的情况下，jvm解释执行的时候会自动放弃同步信息，消除synchronized同步代码的结果，使用锁标记的形式记录锁状态，在Monitor中使用         ACC_SYNCHRONIZED  记录获取对象的线程，可以避免锁的抢夺和锁池状态的维护。</p>
</blockquote>
<br/>
<blockquote>
<p>轻量级锁 当出现多个线程争夺同一个对象锁的时候，先提升为轻量级锁，使用         ACC_SYNCHRONIZED  标记获得锁的线程，使用 ACC_UNSYNCHRONIZED 标记未获得锁的线程，两个线程争夺同一个对象锁的时候可能会出现轻量级锁。</p>
</blockquote>
<br/>
<blockquote>
<p>重量级锁  在锁的底层原理中解释的即为重量级锁</p>
</blockquote>
<br/>
<blockquote>
<p>自旋锁  是一个过度锁，是偏向锁和重量锁的过渡，在获取锁的过程中，未获取到，jvm为了效率，会自动进行多次空循环，来保持线程的状态，而不是进入阻塞，自旋锁避免了线程状态的变更</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Class</span> <span class="n">BuyTicks</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
    
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">ticks</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">flag</span><span class="o">){</span>
            <span class="n">buy</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buy</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">ticks</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">){</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;get ticks &#34;</span> <span class="o">+</span> <span class="n">ticks</span><span class="o">--);</span>	
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">money</span> <span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Account</span><span class="o">(</span><span class="kt">int</span> <span class="n">money</span><span class="o">,</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">money</span> <span class="o">=</span> <span class="n">money</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kd">class</span> <span class="nc">persion</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">Account</span> <span class="n">account</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">nowMoney</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">drawingMoney</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">Account</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">,</span><span class="kt">int</span> <span class="n">nowMoney</span><span class="o">,</span><span class="kt">int</span> <span class="n">drawingMoney</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">nowMoney</span> <span class="o">=</span> <span class="n">nowMoney</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">drawingMoney</span> <span class="o">=</span> <span class="n">drawingMoney</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-</span> <span class="n">drawingMoney</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">){</span>
            
        <span class="o">}</span>
        
        <span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">-</span> <span class="n">drawingMoney</span><span class="o">;</span>
        <span class="n">nowMoney</span> <span class="o">=</span> <span class="n">nowMoney</span> <span class="o">+</span> <span class="n">drawingMoney</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;account money [&#34;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">money</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;now money [&#34;</span> <span class="o">+</span> <span class="n">nowMoney</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
      </div><blockquote class="post-copyright">
  <div class="content">
      <span class="post-time">
        最后更新时间：
        <time datetime="2019-12-11 00:00:00 &#43;0000 UTC" itemprop="dateUpdated">
            2019年12月11日
        </time>
    </span>
    <br>
    原始链接：
    <a href="https://scp131.github.io/thread/" target="_blank" rel="external">
      https://scp131.github.io/thread/
    </a>
  </div>

  <footer>
      <a href="https://scp131.github.io/">
          <img src="/img/avatar.webp" alt="Scp131">
          Scp131
      </a>
  </footer>
</blockquote><div class="post-footer" id="post-footer">
<ul class="article-tag-list">
&nbsp;
      <li class="article-tag-list-item">
          <a class="article-tag-list-link waves-effect waves-button" href="https://scp131.github.io/tags/thread/">
            Thread 
          </a>
        </li>
      
</ul><div class="page-share-wrap"><div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fscp131.github.io%2fthread%2f&title=java%e9%94%81%e5%88%9d%e6%8e%a2&pic=https://s1.ax1x.com/2020/04/15/JPLLrj.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2fscp131.github.io%2fthread%2f&title=java%e9%94%81%e5%88%9d%e6%8e%a2&sharesource=qzone" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fscp131.github.io%2fthread%2f" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=java%e9%94%81%e5%88%9d%e6%8e%a2&url=https%3a%2f%2fscp131.github.io%2fthread%2f&via=xiaomosama" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https%3a%2f%2fscp131.github.io%2fthread%2f" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>

 
<a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
    <i class="icon icon-share-alt icon-lg"></i>
  </a>    
</div> </div>

    </div><nav class="post-nav flex-row flex-justify-between ">
      
  
    <div class="waves-block waves-effect prev">
      <a href="/thread-1/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">线程基本使用</h4>
      </a>
    </div><div class="waves-block waves-effect next">
      <a href="/fdfs/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">使用FDS搭建图床</h4>
      </a>
    </div></nav><div class="comments vcomment v" id="comments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        notify: 'false',
        verify: 'false',
        appId: "OIMzeDHmePmzFKoz8XjwiiIJ-gzGzoHsz",
        appKey: "H5k568nOnKRYMa48PiCWQEk9",
        avatar: "retro",
        placeholder: "请填写邮箱信息以便及时收到回复哦(。・∀・)ノ",
        pageSize: "10"
    })
</script></article>
</div><footer class="footer">
          
    <div class="top">
        <p>
            <span>
              <a href="/index.xml" target="_blank" class="rss" title="rss" rel="noopener noreffer me"><i class="icon icon-lg icon-rss"></i></a>
            </span>
            <span>
              博客内容遵循 
              <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a>
            </span>
        </p>
    </div>
    
    <div class="bottom">
        <p>
          <span>Scp131&copy;2021
                  
          </span>
          
          <span>
              
              <a href="http://www.miitbeian.gov.cn/" target="_blank">豫ICP备123456789号-1</a>
                
              <br>
              
              Power by <a href="https://gohugo.io/" target="_blank">Hugo</a> 
              Theme 
              <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
          </span>
        </p>
    </div>
</footer></main>
        <div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light">
  <span class="icon icon-lg icon-chevron-up"></span>
</a><div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=&title=Scp%20131&pic=https://s1.ax1x.com/2020/04/15/JPLLrj.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=&title=Scp%20131&sharesource=qzone" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=Scp%20131&url=&via=xiaomosama" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>

    
 <div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="/img/wx.png" alt="微信分享二维码">
</div>

</body><div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>
<script type="application/javascript" src="/lib/waves/waves.min.js"></script>




<script type="application/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script>


<script type="text/javascript">
var BLOG = { ROOT: '/', SHARE: true, REWARD: true, SINGLE:  true  };
</script>


<script type="application/javascript" src="/js/main.min.js"></script>


<script type="application/javascript" src="/js/search.min.js" async></script></html>
